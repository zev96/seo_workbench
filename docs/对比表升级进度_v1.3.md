# å¯¹æ¯”è¡¨åŠŸèƒ½å‡çº§è¿›åº¦ (v1.3)

## å·²å®Œæˆ

### âœ… Phase 1: æ–‡æœ¬è‡ªé€‚åº”ä¿®å¤
**æ–‡ä»¶**: `core/comparison_image_generator.py`

**ä¿®æ”¹å†…å®¹**:
1. æ·»åŠ  `_wrap_text()` æ–¹æ³•ï¼šè‡ªåŠ¨æ¢è¡ŒåŠŸèƒ½
   - æŒ‰æ¯è¡Œ15ä¸ªå­—ç¬¦è‡ªåŠ¨åˆ†å‰²
   - æ”¯æŒä¸­è‹±æ–‡æ··åˆ

2. åŠ¨æ€è¡Œé«˜è®¡ç®—ï¼š
   - ç»Ÿè®¡æ¯è¡Œæ–‡æœ¬çš„æ¢è¡Œæ•°
   - æ ¹æ®æ¢è¡Œæ•°åŠ¨æ€åˆ†é…è¡Œé«˜
   - ç¡®ä¿é•¿æ–‡æœ¬å®Œæ•´æ˜¾ç¤º

**æ•ˆæœ**:
- "ç”µåŠ¨é™¤è¨åˆ·ã€é•¿æ‰å¸ã€ä¸»åœ°åˆ·" â†’ è‡ªåŠ¨æ¢è¡Œä¸º2-3è¡Œ
- è¡¨æ ¼è¡Œé«˜è‡ªåŠ¨è°ƒæ•´ï¼Œä¸å†æˆªæ–­æ–‡æœ¬

### âœ… Phase 2: æ•°æ®åº“æ¨¡å‹å‡çº§ï¼ˆè¿›è¡Œä¸­ï¼‰
**æ–‡ä»¶**: `database/models.py`

**æ–°å¢è¡¨**:
1. `ComparisonTask` - ä»»åŠ¡è¡¨
   ```python
   - id: ä»»åŠ¡ID
   - category_id: å…³è”ç±»ç›®
   - task_name: ä»»åŠ¡åç§°ï¼ˆå¦‚"ä»·æ ¼å¯¹æ¯”è¡¨"ï¼‰
   - sort_order: æ’åº
   - insert_mode: æ’å…¥æ¨¡å¼ï¼ˆcolumn/anchorï¼‰
   - insert_column: æ’å…¥åˆ—å·
   - insert_anchor_text: é”šç‚¹æ–‡æœ¬
   - style_config: æ ·å¼é…ç½®JSON
   ```

2. `TaskParameterSelection` - å‚æ•°é€‰æ‹©å…³è”è¡¨
   ```python
   - id: ä¸»é”®
   - task_id: ä»»åŠ¡ID
   - parameter_id: å‚æ•°ID
   ```

**æ•°æ®å…³ç³»**:
```
ComparisonTask (1) â†â†’ (N) TaskParameterSelection â†â†’ (1) ComparisonParameter
```

---

## å¾…å®ç°

### ğŸ”„ Phase 2: æ•°æ®åº“ç®¡ç†å™¨æ‰©å±•
**æ–‡ä»¶**: `database/comparison_db_manager.py`

**éœ€è¦æ·»åŠ çš„æ–¹æ³•**:
```python
# ä»»åŠ¡ç®¡ç†
- add_task(category_id, task_name, ...)
- delete_task(task_id)
- update_task(task_id, ...)
- get_tasks_by_category(category_id)
- reorder_tasks(task_ids)

# å‚æ•°é€‰æ‹©ç®¡ç†
- set_task_parameters(task_id, parameter_ids)
- get_task_parameters(task_id)
- clear_task_parameters(task_id)
```

### ğŸ“ Phase 3: å‚æ•°é€‰æ‹©UI
**æ–‡ä»¶**: `ui/dialogs/parameter_selection_dialog.py` (æ–°å»º)

**UIç»„ä»¶**:
- å¤é€‰æ¡†åˆ—è¡¨ï¼ˆæ˜¾ç¤ºæ‰€æœ‰å‚æ•°ï¼‰
- å…¨é€‰æŒ‰é’®
- åé€‰æŒ‰é’®
- ç¡®å®š/å–æ¶ˆæŒ‰é’®

### ğŸ¨ Phase 4: å¤šä»»åŠ¡é…ç½®UI
**æ–‡ä»¶**: `ui/dialogs/multi_task_config_dialog.py` (æ–°å»º)

**å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å…¨å±€è®¾ç½®                            â”‚
â”‚  æˆ‘æ–¹å“ç‰Œ: [____]  ä¿åº•: [2]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ä»»åŠ¡åˆ—è¡¨  â”‚  ä»»åŠ¡é…ç½®                â”‚
â”‚ â–¶ ä»»åŠ¡A  â”‚  åç§°: [____]            â”‚
â”‚   ä»»åŠ¡B  â”‚  å‚æ•°: [é€‰æ‹©å‚æ•°...]      â”‚
â”‚          â”‚  ä½ç½®: [____]            â”‚
â”‚ [æ–°å¢]   â”‚  æ ·å¼: [____]            â”‚
â”‚ [åˆ é™¤]   â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ–¼ï¸ Phase 5: å›¾ç‰‡ç”Ÿæˆé€»è¾‘å‡çº§
**æ–‡ä»¶**: `core/comparison_image_generator.py`

**ä¿®æ”¹**:
- `generate_from_category()` æ·»åŠ  `selected_parameter_ids` å‚æ•°
- æ ¹æ®å‚æ•°IDåˆ—è¡¨è¿‡æ»¤è¦æ˜¾ç¤ºçš„å‚æ•°è¡Œ

### ğŸ“„ Phase 6: æ–‡æ¡£ç”Ÿæˆé€»è¾‘å‡çº§
**æ–‡ä»¶**: `ui/main_window.py`, `core/document_generator.py`

**ä¿®æ”¹**:
- åŠ è½½æ‰€æœ‰ä»»åŠ¡åˆ—è¡¨
- æŒ‰sort_orderæ’åº
- éå†ä»»åŠ¡ï¼Œæ£€æŸ¥æ’å…¥æ¡ä»¶
- æ”¯æŒä¸€ç¯‡æ–‡ç« æ’å…¥å¤šå¼ è¡¨æ ¼

### ğŸ§ª Phase 7: æµ‹è¯•
- åˆ›å»ºå¤šä¸ªä»»åŠ¡
- æµ‹è¯•å‚æ•°é€‰æ‹©
- æµ‹è¯•å¤šè¡¨æ ¼æ’å…¥
- éªŒè¯æ–‡æœ¬æ¢è¡Œæ•ˆæœ

---

## æŠ€æœ¯ç»†èŠ‚

### å…¨å±€é…ç½® vs ä»»åŠ¡é…ç½®

**å…¨å±€é…ç½®** (å­˜å‚¨åœ¨ `comparison_configs` è¡¨):
```json
{
  "own_brand_name": "CEWEY DS18",
  "fallback_competitor_count": 2
}
```

**ä»»åŠ¡é…ç½®** (å­˜å‚¨åœ¨ `comparison_tasks` è¡¨):
```json
{
  "task_id": 1,
  "task_name": "ä»·æ ¼å¯¹æ¯”è¡¨",
  "insert_mode": "anchor",
  "insert_anchor_text": "å‚æ•°å¯¹æ¯”",
  "style_config": {
    "preset": "business_blue",
    "dpi": 300,
    ...
  },
  "selected_parameters": [1, 2, 5]  // å‚æ•°IDåˆ—è¡¨
}
```

### æ‰§è¡Œæµç¨‹

```
1. æ–‡æ¡£ç”Ÿæˆå¼€å§‹
   â†“
2. åŠ è½½å…¨å±€é…ç½®ï¼ˆå“ç‰Œè¯†åˆ«ï¼‰
   â†“
3. åŠ è½½æ‰€æœ‰ä»»åŠ¡åˆ—è¡¨ï¼ˆæŒ‰sort_orderæ’åºï¼‰
   â†“
4. éå†æ¯ä¸€åˆ—å†…å®¹
   â†“
5. å¯¹æ¯ä¸ªä»»åŠ¡æ£€æŸ¥æ’å…¥æ¡ä»¶
   â”œâ”€ æŒ‰åˆ—æ¨¡å¼ï¼šcol_idx == task.insert_column
   â””â”€ é”šç‚¹æ¨¡å¼ï¼štask.insert_anchor_text in content
   â†“
6. è§¦å‘æ’å…¥ â†’ ç”Ÿæˆå›¾ç‰‡ï¼ˆä½¿ç”¨ä»»åŠ¡çš„å‚æ•°é€‰æ‹©ï¼‰
   â†“
7. ç»§ç»­ä¸‹ä¸€åˆ—
```

---

## å½“å‰çŠ¶æ€

- âœ… æ–‡æœ¬è‡ªé€‚åº”ï¼šå·²å®Œæˆ
- âœ… æ•°æ®åº“æ¨¡å‹ï¼šå·²å®Œæˆ
- ğŸ”„ æ•°æ®åº“ç®¡ç†å™¨ï¼šè¿›è¡Œä¸­
- â³ UIç•Œé¢ï¼šå¾…å¼€å§‹
- â³ é€»è¾‘é›†æˆï¼šå¾…å¼€å§‹

é¢„è®¡è¿˜éœ€è¦å®ç°çº¦1500è¡Œä»£ç ã€‚

