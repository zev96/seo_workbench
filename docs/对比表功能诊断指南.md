# 对比表功能诊断指南

## 问题：生成的文档中没有对比表图片

### 解决方案概述

我已经增强了以下功能：

1. **品牌识别增强**：支持部分匹配
   - "CEWEY DS18" → 自动提取核心词 "CEWEY"
   - "米家3C" → 自动提取核心词 "米家"
   - "戴森V8" → 自动提取核心词 "戴森"
   
2. **详细调试日志**：每个关键步骤都有日志输出

3. **错误处理增强**：详细的异常追踪

---

## 诊断步骤

### 步骤1：检查配置

打开"数据库"界面，确认：

1. **类目是否存在**
   - 至少有一个类目（如"吸尘器"）
   
2. **品牌数据是否完整**
   - 有我方品牌（需要在UI中设置，或数据库中标记 is_own=1）
   - 有竞品品牌

3. **参数数据是否完整**
   - 至少有几个参数（如"价格"、"功率"等）
   - 各品牌的参数值已填写

### 步骤2：检查插入策略配置

点击"插入策略配置"按钮，确认：

**品牌匹配设置：**
- **我方品牌名称**：填写你的品牌名（完整名称，如"CEWEY DS18"）
- **保底竞品数量**：设置为2或更多

**插入位置设置：**
- **插入模式**：
  - 如果选择"按列插入"：
    - 确认"插入列号"正确（第几列后插入图片）
    - 例如：设置为1表示在第1列后插入
  
  - 如果选择"智能锚点"：
    - 确认"锚点文本"已填写（如"参数对比"）
    - 确保你的文章中包含这个文本

### 步骤3：检查样式配置

点击"表格样式设置"按钮，确认：
- 各项配置正常
- DPI设置为300
- 图片宽度设置为15cm

保存后，配置会自动存储到数据库。

### 步骤4：生成测试文档

1. 在工作台编辑区，确保：
   - **文章中包含品牌关键词**
   - 例如：提到"CEWEY"、"米家"、"戴森"等
   
2. 如果使用智能锚点模式：
   - 确保某一列的内容包含锚点文本
   - 例如：某一列写"下面是参数对比"

3. 点击"开始生成"

### 步骤5：查看日志

生成过程中，查看日志面板（或日志文件），关键日志信息：

```
✓ 触发对比表插入: 智能锚点匹配（锚点文本='参数对比'）
使用类目: 吸尘器 (ID=1)
数据库中共有 33 个品牌
文章中提及的品牌: ['CEWEY DS18', '米家3C']
品牌核心词匹配: CEWEY DS18 (核心词: CEWEY)
品牌核心词匹配: 米家3C (核心词: 米家)
识别到的品牌: ['CEWEY DS18', '米家3C']
找到我方品牌（按名称）: CEWEY DS18
✓ 我方品牌已加入: CEWEY DS18
✓ 竞品已加入（文章提及）: 米家3C
最终选择的品牌: ['CEWEY DS18', '米家3C', ...]
对比表图片生成成功: C:\Users\...\comparison_table_xxx.png
✓ 对比表图片已插入: C:\Users\...\comparison_table_xxx.png
```

---

## 常见问题诊断

### 问题1：日志显示"对比表功能不可用或未配置"

**原因**：
- matplotlib未安装
- 配置未保存

**解决**：
```bash
pip install matplotlib==3.8.2
```
然后重新配置并保存。

---

### 问题2：日志显示"不满足插入条件"

**原因**：
- 插入模式配置不正确
- 列索引不匹配
- 锚点文本未找到

**解决**：
- 按列插入模式：检查列索引是否正确（从0开始计数）
- 智能锚点模式：确保文章中包含锚点文本

**示例**：
```
# 你的网格内容：
列0: H1标题
列1: 产品介绍
列2: 使用体验    ← 如果想在这列后插入，设置"插入列号"为3
列3: 总结
```

---

### 问题3：日志显示"识别到的品牌: 无"

**原因**：
- 文章中没有提及任何品牌
- 品牌名称不匹配

**解决**：

**方法1：使用品牌核心词**
文章中只需要提到品牌核心词即可，例如：
- 数据库中的品牌：`CEWEY DS18`
- 文章中写：`CEWEY吸尘器性能出色...` ✓ 可以匹配
- 文章中写：`DS18型号...` ✗ 不能匹配（没有品牌核心词）

**方法2：使用完整品牌名**
文章中写完整名称：
- `CEWEY DS18这款吸尘器...` ✓ 完美匹配

**测试你的品牌识别**：
在生成文档时，查看日志中的：
```
品牌完整匹配: CEWEY DS18
品牌核心词匹配: 米家3C (核心词: 米家)
识别到的品牌: ['CEWEY DS18', '米家3C']
```

---

### 问题4：日志显示"未找到我方品牌"

**原因**：
- 我方品牌名称设置不正确
- 数据库中没有标记我方品牌

**解决**：
1. 在"数据库"界面，重新添加我方品牌
2. 在"插入策略配置"中，填写**完整的品牌名称**
   - 例如：`CEWEY DS18`（不是`CEWEY`）
3. 或者，在数据库中手动标记品牌为我方品牌（通过UI删除重新添加，确保是第一个添加的）

---

### 问题5：图片生成但没有插入到文档

**原因**：
- 图片路径问题
- Word插入失败

**解决**：
查看日志中的完整错误信息，特别是：
```
对比表图片生成成功: C:\...\comparison_table_xxx.png
✓ 对比表图片已插入: C:\...\comparison_table_xxx.png
```

如果只有第一行，没有第二行，说明插入失败。

---

## 快速测试方案

### 方案1：按列插入测试

1. 在网格中编辑内容，确保有至少2列
2. 配置策略：
   - 插入模式：按列插入
   - 插入列号：1（在第1列后插入）
3. 生成文档
4. 检查Word文档第1列和第2列之间是否有图片

### 方案2：智能锚点测试

1. 在网格某一列中添加文本："下面是参数对比："
2. 配置策略：
   - 插入模式：智能锚点
   - 锚点文本：参数对比
3. 生成文档
4. 检查Word文档中"参数对比"文本后是否有图片

---

## 手动测试品牌识别

创建一个简单的测试文档：

**网格内容：**
```
列0：吸尘器选购指南
列1：市场上有CEWEY、米家、戴森等品牌，参数对比如下：
列2：综合来看，性价比很高。
```

**配置：**
- 插入模式：智能锚点
- 锚点文本：参数对比
- 我方品牌：CEWEY DS18

**预期结果：**
- 识别品牌：CEWEY DS18, 米家3C, 戴森V8（根据你数据库中的品牌）
- 在"参数对比"后插入图片

---

## 联系支持

如果以上步骤都无法解决问题，请提供：
1. 日志文件（`logs/seo_workbench_*.log`）
2. 配置截图
3. 生成的Word文档

查看日志中是否有：
- `✓ 触发对比表插入`
- `识别到的品牌`
- `对比表图片生成成功`
- `对比表图片已插入`

这些信息将帮助快速定位问题！

