# 对比表功能 v1.3 完整使用指南

## 🎉 新功能概览

### 1. 文本自适应 ✅
- 长文本自动换行（每行15字符）
- 动态行高自动调整
- 确保所有文字完整显示

### 2. 参数精准选择 ✅
- 每个任务可独立选择要对比的参数
- 支持全选/反选
- 灵活控制表格内容

### 3. 多任务系统 ✅
- 一篇文章可插入多张不同的对比表
- 每个任务独立配置
- 按文章顺序自动插入

---

## 📖 完整使用流程

### 第一步：准备数据

1. 打开程序，点击左侧导航栏的 **"数据库"**

2. **创建类目**
   - 点击左侧 "新建类目"
   - 输入类目名称（如：吸尘器）

3. **添加品牌和参数**
   - 方式1：手动添加
     - 右键表格 → 插入列（添加品牌）
     - 右键表格 → 插入行（添加参数）
     - 双击单元格编辑内容
   
   - 方式2：Excel导入
     - 准备Excel文件（第一行=品牌，第一列=参数）
     - 点击 "导入 Excel"
     - 选择文件自动导入

### 第二步：配置任务

1. **打开任务配置**
   - 在数据库界面，点击顶部 **"插入策略配置"** 按钮
   - 进入多任务配置对话框

2. **设置全局配置**
   ```
   我方品牌名称: CEWEY DS18
   保底竞品数量: 2
   ```

3. **创建任务**
   - 点击左侧 "新增任务"
   - 输入任务名称（如："价格对比表"）

4. **配置任务详情**
   
   **a. 选择参数**
   - 在参数列表中勾选要对比的参数
   - 例如：☑ 价格、☑ 吸力(AW)、☑ 最低噪音
   - 使用 "全选" 或 "反选" 快速操作
   
   **b. 设置插入位置**
   - 按列插入：在第 N 列后插入
   - 智能锚点：检测到特定文本后插入
   
   **c. 选择样式**
   - 预设风格：商务蓝/清新绿/强对比黄
   - 分辨率：300 DPI（推荐）

5. **保存任务**
   - 点击 "保存当前任务"

6. **创建更多任务（可选）**
   - 重复步骤3-5
   - 例如：
     - 任务A：价格对比（3个参数）
     - 任务B：续航对比（3个参数）
     - 任务C：完整参数（全部参数）

7. **保存全部**
   - 点击对话框底部 "保存全部" 按钮

### 第三步：生成文档

1. **编辑内容**
   - 返回主界面工作台
   - 在网格中编辑文章内容
   - **重要**：文章中要包含完整的品牌名称

2. **示例内容**
   ```
   第1列：吸尘器选购指南
   第2列：市面上有CEWEY DS18、小狗T12、戴森V8等型号
   第3列：下面是价格对比：
   第4列：接下来看续航对比：
   第5列：最后是完整参数对比：
   ```

3. **生成文档**
   - 点击 "开始生成"
   - 系统会自动：
     - 识别品牌（CEWEY DS18、小狗T12、戴森V8）
     - 检查所有任务的插入条件
     - 按顺序插入对应的对比表图片

4. **查看结果**
   - 打开生成的Word文档
   - 应该看到：
     - 第3列后：价格对比表（3个参数）
     - 第4列后：续航对比表（3个参数）
     - 第5列后：完整参数表（所有参数）

---

## 🎯 使用场景示例

### 场景1：简单对比
**需求**：只对比价格和性能

**配置**：
- 创建1个任务
- 选择参数：价格、吸力、功率
- 插入位置：锚点"参数对比"

**文章**：
```
...市面上有CEWEY DS18、戴森V8等型号，参数对比如下：
[这里会自动插入对比表]
综合来看性价比很高...
```

### 场景2：分段对比
**需求**：分别对比价格、续航、完整参数

**配置**：
- 任务A：价格对比
  - 参数：价格、产品类型
  - 位置：锚点"价格对比"
  
- 任务B：续航对比
  - 参数：最长续航、强力模式续航、电池容量
  - 位置：锚点"续航对比"
  
- 任务C：完整参数
  - 参数：全选
  - 位置：锚点"完整参数"

**文章**：
```
第1段：介绍
第2段：价格对比：[插入任务A]
第3段：续航对比：[插入任务B]
第4段：完整参数：[插入任务C]
第5段：总结
```

### 场景3：按列自动插入
**需求**：固定位置插入

**配置**：
- 任务A：在第2列后插入
- 任务B：在第4列后插入

**文章**：
```
第1列：标题
第2列：介绍 → [插入任务A]
第3列：使用体验
第4列：深度分析 → [插入任务B]
第5列：总结
```

---

## ⚙️ 高级技巧

### 1. 参数排序
- 参数在表格中的顺序与数据库中的顺序一致
- 如需调整，在数据库界面删除后重新添加

### 2. 任务排序
- 任务按创建顺序执行
- 如需调整，删除后重新创建

### 3. 样式复用
- 多个任务可以使用相同的样式
- 建议统一使用一种风格

### 4. 品牌识别
- 必须使用完整品牌名（如"CEWEY DS18"）
- 不支持简称（如"CEWEY"）

### 5. 保底机制
- 如果文章未提及足够的竞品
- 系统会随机选择品牌补充到保底数量

---

## 🐛 常见问题

### Q1: 对比表没有插入？
**检查**：
1. 是否创建了任务？
2. 任务是否选择了参数？
3. 插入条件是否满足？
   - 按列：列索引是否正确？
   - 锚点：文章中是否包含锚点文本？

### Q2: 表格中品牌不对？
**原因**：品牌识别失败

**解决**：
- 确保文章中使用完整品牌名
- 检查数据库中的品牌名是否正确

### Q3: 文本还是被截断？
**原因**：文本过长

**解决**：
- 当前每行15字符
- 如需调整，修改 `comparison_image_generator.py` 中的 `max_chars_per_line`

### Q4: 如何删除任务？
**步骤**：
1. 打开任务配置对话框
2. 选中要删除的任务
3. 点击 "删除任务"

### Q5: 多个任务能用不同类目吗？
**当前版本**：所有任务使用同一个类目（第一个类目）

**未来版本**：会支持为每个任务指定类目

---

## 📊 技术说明

### 数据库表结构
```
comparison_categories (类目表)
  ├─ comparison_brands (品牌表)
  ├─ comparison_parameters (参数表)
  ├─ comparison_values (数值表)
  └─ comparison_tasks (任务表)
       └─ task_parameter_selections (参数选择表)
```

### 执行流程
```
1. 加载全局配置（品牌识别规则）
2. 加载所有任务（按sort_order排序）
3. 遍历文章每一列
4. 对每个任务检查插入条件
5. 满足条件 → 生成图片 → 插入文档
6. 继续下一列
```

### 文件修改清单
```
✅ database/models.py - 新增2个表
✅ database/comparison_db_manager.py - 新增任务管理方法
✅ database/init_db.py - 导入新模型
✅ core/comparison_image_generator.py - 支持参数过滤+文本换行
✅ ui/dialogs/multi_task_config_dialog.py - 新增多任务配置对话框
✅ ui/widgets/comparison_table.py - 更新对话框调用
✅ ui/main_window.py - 更新文档生成逻辑
```

---

## 🚀 快速测试

### 测试1：文本换行
1. 在数据库中添加长文本（如"电动除螨刷、长扁吸、主地刷、二合一毛刷"）
2. 生成文档
3. 查看对比表图片，文本应该自动换行

### 测试2：参数选择
1. 创建任务，只选择3个参数
2. 生成文档
3. 对比表应该只显示选中的3个参数

### 测试3：多任务
1. 创建3个任务，不同参数，不同位置
2. 生成文档
3. 应该看到3张不同的对比表

---

## 📝 版本历史

### v1.3 (2025-12-03)
- ✅ 文本自动换行
- ✅ 动态行高调整
- ✅ 参数精准选择
- ✅ 多任务系统
- ✅ 任务独立配置
- ✅ 按顺序自动插入

### v1.2 (2025-12-03)
- ✅ 品牌精确匹配
- ✅ 基础对比表功能

### v1.0 (2025-12-03)
- ✅ 数据库管理
- ✅ Excel导入
- ✅ 基础配置

---

现在你可以享受强大的多任务对比表功能了！🎉

