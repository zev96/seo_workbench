# çŸ¥ä¹ç›‘æµ‹ v2.2 å®ç°è®¡åˆ’

## ğŸ¯ æœ¬æ¬¡æ›´æ–°ç›®æ ‡

### P0 - ç´§æ€¥ä¿®å¤
- [x] ä¿®å¤Top10é‡‡é›†ä¸å®Œæ•´ï¼ˆç¡®ä¿å§‹ç»ˆé‡‡é›†10æ¡ï¼‰
- [ ] ä¿®å¤çŠ¶æ€æ˜¾ç¤ºé”™è¯¯
- [ ] å¢åŠ æ¸©å’Œæ¨¡å¼ï¼ˆé˜²å°ï¼‰

### P1 - æ ¸å¿ƒåŠŸèƒ½
- [ ] æ·»åŠ å‹¾é€‰æ¡†ï¼ˆé€‰æ‹©æ€§æ£€æµ‹ï¼‰
- [ ] æ‰¹é‡å¯¼å…¥Excel

### P2 - ä¼˜åŒ–åŠŸèƒ½
- [ ] æ‰¹é‡åˆ é™¤
- [ ] å¯¼å‡ºExcelæ¨¡æ¿
- [ ] æ‰¹é‡è®¾ç½®å®šæ—¶

---

## ğŸ“ è¯¦ç»†å®ç°æ–¹æ¡ˆ

### 1. ä¿®å¤Top10é‡‡é›† âœ… å·²å®Œæˆ

**é—®é¢˜**ï¼šæœ‰æ—¶åªé‡‡é›†5æ¡ï¼Œæœ‰æ—¶10æ¡
**åŸå› **ï¼šå¾ªç¯èŒƒå›´æ˜¯`check_range`ï¼Œå¦‚æœç”¨æˆ·è®¾ç½®Top5å°±åªé‡‡é›†5æ¡
**è§£å†³**ï¼š
```python
# ç¡®ä¿è‡³å°‘å¤„ç†10ä¸ªå›ç­”
scan_count = max(10, min(check_range, len(answers)))
```

---

### 2. ä¿®å¤çŠ¶æ€æ˜¾ç¤º

**é—®é¢˜**ï¼šæ£€æµ‹å®Œæˆä½†æ˜¾ç¤º"å¾…æ£€æµ‹"
**åŸå› **ï¼šå¯èƒ½æ˜¯`status`å­—æ®µæ›´æ–°å¤±è´¥æˆ–åˆ¤æ–­é€»è¾‘é”™è¯¯
**è§£å†³**ï¼š
1. æ£€æŸ¥`_on_task_completed`ä¸­çš„statusæ›´æ–°
2. æ£€æŸ¥`_get_status_display`çš„åˆ¤æ–­é€»è¾‘
3. ç¡®ä¿commitæˆåŠŸ

---

### 3. æ¸©å’Œæ¨¡å¼

**æ•°æ®åº“**ï¼š
```sql
ALTER TABLE zhihu_monitor_configs ADD COLUMN gentle_mode INTEGER DEFAULT 0;
```

**é…ç½®å¯¹è¯æ¡†**ï¼š
- æ·»åŠ "æ¸©å’Œæ¨¡å¼"å¼€å…³
- è¯´æ˜ï¼šæ›´é•¿é—´éš”ã€æ›´å°‘æ»šåŠ¨ã€æ›´å®‰å…¨

**Workeré€»è¾‘**ï¼š
```python
if config.get('gentle_mode'):
    delay_min = 8
    delay_max = 15
    max_scrolls = 3
    scroll_wait = 3
else:
    delay_min = config.get('delay_min', 4)
    delay_max = config.get('delay_max', 8)
    max_scrolls = 5
    scroll_wait = 1.5
```

---

### 4. å‹¾é€‰æ¡†åŠŸèƒ½

**UIæ”¹åŠ¨**ï¼š
```python
# è¡¨æ ¼ç¬¬ä¸€åˆ—æ·»åŠ å¤é€‰æ¡†
self.table.setColumnCount(8)  # å¢åŠ ä¸€åˆ—
self.table.setHorizontalHeaderLabels([
    "â˜", "é—®é¢˜æ ‡é¢˜", "ç›®æ ‡å“ç‰Œ", "çŠ¶æ€", "æ’å", "æµè§ˆé‡/å…³æ³¨", "æœ€åæ›´æ–°", "æ“ä½œ"
])

# æ·»åŠ å…¨é€‰å¤é€‰æ¡†åˆ°è¡¨å¤´
self.select_all_checkbox = QCheckBox()
self.select_all_checkbox.stateChanged.connect(self._on_select_all)
```

**æ£€æµ‹é€»è¾‘**ï¼š
```python
def _start_check(self):
    # åªè·å–å‹¾é€‰çš„ä»»åŠ¡
    selected_tasks = []
    for row in range(self.table.rowCount()):
        checkbox = self.table.cellWidget(row, 0)
        if checkbox and checkbox.isChecked():
            task_id = checkbox.property('task_id')
            selected_tasks.append(task_id)
    
    if not selected_tasks:
        MessageBox("æç¤º", "è¯·å…ˆå‹¾é€‰è¦æ£€æµ‹çš„ä»»åŠ¡", self).exec()
        return
```

---

### 5. æ‰¹é‡å¯¼å…¥Excel

**UI**ï¼š
```python
self.import_btn = PushButton("å¯¼å…¥Excel", self, FluentIcon.FOLDER_ADD)
self.import_btn.clicked.connect(self._import_excel)
```

**Excelæ ¼å¼**ï¼š
| é—®é¢˜é“¾æ¥ | ç›®æ ‡å“ç‰Œ | æ£€æµ‹èŒƒå›´ |
|---------|---------|---------|
| https://... | CEWEY | 20 |

**å¯¼å…¥é€»è¾‘**ï¼š
```python
def _import_excel(self):
    file_path, _ = QFileDialog.getOpenFileName(
        self, "é€‰æ‹©Excelæ–‡ä»¶", "", "Excelæ–‡ä»¶ (*.xlsx *.xls)"
    )
    
    df = pd.read_excel(file_path)
    
    for index, row in df.iterrows():
        url = row['é—®é¢˜é“¾æ¥']
        brand = row.get('ç›®æ ‡å“ç‰Œ', default_brand)
        range_val = row.get('æ£€æµ‹èŒƒå›´', 20)
        
        # æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        exists = self.db_session.query(ZhihuMonitorTask).filter(
            ZhihuMonitorTask.question_url == url
        ).first()
        
        if exists:
            logger.info(f"è·³è¿‡å·²å­˜åœ¨çš„é“¾æ¥: {url}")
            continue
        
        # æ·»åŠ ä»»åŠ¡
        new_task = ZhihuMonitorTask(...)
        self.db_session.add(new_task)
    
    self.db_session.commit()
```

---

### 6. å¯¼å‡ºExcelæ¨¡æ¿

**åŠŸèƒ½**ï¼š
```python
self.template_btn = PushButton("ä¸‹è½½æ¨¡æ¿", self, FluentIcon.DOWNLOAD)
self.template_btn.clicked.connect(self._download_template)

def _download_template(self):
    template_data = {
        'é—®é¢˜é“¾æ¥': ['https://www.zhihu.com/question/123456789'],
        'ç›®æ ‡å“ç‰Œ': ['CEWEY'],
        'æ£€æµ‹èŒƒå›´': [20]
    }
    
    df = pd.DataFrame(template_data)
    
    file_path, _ = QFileDialog.getSaveFileName(
        self, "ä¿å­˜æ¨¡æ¿", "çŸ¥ä¹ç›‘æµ‹å¯¼å…¥æ¨¡æ¿.xlsx", "Excelæ–‡ä»¶ (*.xlsx)"
    )
    
    df.to_excel(file_path, index=False)
```

---

### 7. æ‰¹é‡åˆ é™¤

**UI**ï¼š
```python
self.batch_delete_btn = PushButton("æ‰¹é‡åˆ é™¤", self, FluentIcon.DELETE)
self.batch_delete_btn.clicked.connect(self._batch_delete)

def _batch_delete(self):
    selected_ids = self._get_selected_task_ids()
    
    if not selected_ids:
        MessageBox("æç¤º", "è¯·å…ˆå‹¾é€‰è¦åˆ é™¤çš„ä»»åŠ¡", self).exec()
        return
    
    reply = MessageBox(
        "ç¡®è®¤åˆ é™¤",
        f"ç¡®å®šè¦åˆ é™¤ {len(selected_ids)} ä¸ªä»»åŠ¡å—ï¼Ÿ",
        self
    )
    
    if reply.exec():
        for task_id in selected_ids:
            task = self.db_session.query(ZhihuMonitorTask).get(task_id)
            self.db_session.delete(task)
        
        self.db_session.commit()
        self._load_tasks()
```

---

## ğŸ”„ å®æ–½æ­¥éª¤

1. âœ… ä¿®å¤Top10é‡‡é›†ï¼ˆå·²å®Œæˆï¼‰
2. â³ ä¿®å¤çŠ¶æ€æ˜¾ç¤º
3. â³ æ·»åŠ æ¸©å’Œæ¨¡å¼
4. â³ å®ç°å‹¾é€‰æ¡†
5. â³ å®ç°Excelå¯¼å…¥
6. â³ å®ç°æ‰¹é‡æ“ä½œ
7. â³ æµ‹è¯•éªŒè¯

---

## ğŸ“Š é¢„è®¡å·¥ä½œé‡

- P0ä¿®å¤ï¼š30åˆ†é’Ÿ
- P1åŠŸèƒ½ï¼š1å°æ—¶
- P2ä¼˜åŒ–ï¼š30åˆ†é’Ÿ
- æµ‹è¯•ï¼š30åˆ†é’Ÿ

**æ€»è®¡**ï¼šçº¦2.5å°æ—¶

